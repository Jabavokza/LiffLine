<!DOCTYPE html>
<html lang="en">
<head>
    <title>LIFF App with Email</title>
</head>
<body>
    <h1>Welcome to LIFF!</h1>
    <div id="userInfo">
        <p>สวัสดีคุณ:</p>
        <img id="pictureUrl" src="" alt="Profile Picture">
        <p id="displayName"></p>
        <p id="userId"></p>
        <p id="email" style="font-weight: bold;"></p>
    </div>
    <p id="status"></p>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        async function main() {
            try {
                await liff.init({ liffId: "YOUR_LIFF_ID" }); // ใส่ LIFF ID ของคุณ

                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    document.getElementById('status').innerText = 'You are logged in.';

                    // --- ส่วนที่เปลี่ยนแปลง ---
                    // 1. ดึงข้อมูลโปรไฟล์ (เหมือนเดิม) เพื่อเอารูปและชื่อ
                    const profile = await liff.getProfile();
                    document.getElementById("pictureUrl").src = profile.pictureUrl;
                    document.getElementById("displayName").innerText = profile.displayName;
                    document.getElementById("userId").innerText = "User ID: " + profile.userId;

                    // 2. ดึง ID Token เพื่อเอาอีเมล
                    const idToken = liff.getDecodedIDToken();
                    const userEmail = idToken.email; // <-- ดึงอีเมลจากตรงนี้

                    if (userEmail) {
                        document.getElementById("email").innerText = "Email: " + userEmail;
                    } else {
                        document.getElementById("email").innerText = "ไม่ได้รับอนุญาตให้เข้าถึงอีเมล";
                    }
                    // --- สิ้นสุดส่วนที่เปลี่ยนแปลง ---

                    document.getElementById("userInfo").style.display = "block";
                    // ... โค้ดส่วนจัดการปุ่มเหมือนเดิม ...
                }
            } catch (err) {
                document.getElementById('status').innerText = 'LIFF init failed.';
                console.error(err);
            }
        }

        main();
    </script>
</body>
</html>
